# Редактирование маски сегментации

## Обзор функциональности

Добавлена возможность редактирования маски сегментации с помощью рисования. Пользователи могут вручную корректировать результаты автоматической сегментации, добавлять новые области или изменять классификацию существующих регионов.

## Основные возможности

### 1. Кнопка редактирования
- На экране сегментации поверх сегментированного изображения появляется кнопка с иконкой карандаша
- Нажатие на кнопку открывает экран редактирования маски

### 2. Экран редактирования маски
- **Холст для рисования**: Отображает текущее сегментированное изображение с возможностью рисования поверх него
- **Панель инструментов**: Содержит кнопки управления и переключения режимов
- **Селектор классов**: Горизонтальная прокручиваемая панель с цветными блоками классов

### 3. Режимы рисования

#### Интеллектуальный режим (по умолчанию)
- Автоматически выделяет области с похожими цветами
- Работает как "магическая палочка" в Photoshop
- Анализирует цвета пикселей в радиусе касания
- Применяет сегментацию к похожим по цвету областям

#### Обычный режим
- Классическое рисование кистью
- Фиксированный размер кисти
- Прямое закрашивание областей

### 4. Управление классами

#### Существующие классы
- Отображаются как цветные прямоугольники с сокращенным названием
- **Одиночное нажатие**: Выбор класса для рисования
- **Долгое нажатие**: Изменение названия класса
- Пользовательские классы отмечены точкой

#### Добавление новых классов
- Кнопка "+" для создания нового класса
- Выбор из полного списка доступных продуктов (labels.txt)
- Автоматическое присвоение случайного цвета
- Поиск по названию продукта

### 5. Элементы управления

#### Верхняя панель
- **Закрыть (X)**: Отмена изменений и возврат к предыдущему экрану
- **Режим рисования**: Переключение между интеллектуальным и обычным режимами
- **Отмена (↶)**: Сброс всех изменений к исходному состоянию
- **Сохранить (✓)**: Применение изменений и обновление маски

#### Нижняя панель
- **Индикатор режима**: Показывает текущий режим рисования
- **Переключатель**: Switch для быстрого изменения режима
- **Селектор классов**: Прокручиваемый список доступных классов
- **Информация о выбранном классе**: Название и подсказка по использованию

## Технические детали

### Алгоритм интеллектуального рисования
1. **Анализ цвета**: При касании экрана анализируется цвет пикселя в точке касания
2. **Поиск похожих областей**: В радиусе кисти ищутся пиксели с похожими цветами
3. **Цветовая толерантность**: Используется порог в 30 единиц RGB для определения схожести
4. **Применение маски**: Найденные похожие пиксели помечаются выбранным классом

### Сглаживание штрихов
- Автоматическое сглаживание траектории рисования
- Использование кривых Безье для плавных линий
- Оптимизация количества точек для производительности

### Обновление маски
- Реальное время: Изменения применяются немедленно
- Неразрушающее редактирование: Исходная маска сохраняется до подтверждения
- Эффективное обновление: Только измененные области перерисовываются

## Использование

1. **Откройте изображение** для сегментации
2. **Дождитесь завершения** автоматической сегментации
3. **Нажмите кнопку редактирования** (карандаш) на сегментированном изображении
4. **Выберите класс** из нижней панели
5. **Выберите режим рисования** (интеллектуальный рекомендуется)
6. **Рисуйте** на изображении для корректировки маски
7. **Сохраните изменения** или отмените их

## Файлы проекта

### Новые файлы
- `MaskEditingScreen.kt` - Основной экран редактирования маски

### Измененные файлы
- `ImageSegmentationScreen.kt` - Добавлена кнопка редактирования и интеграция

### Используемые ресурсы
- `labels.txt` - Список доступных классов продуктов
- Иконки Material Design для интерфейса

## Зависимости

- Compose UI для интерфейса
- Material Design 3 для компонентов
- Kotlin Coroutines для асинхронных операций
- Android Graphics API для работы с изображениями 